services:
  - type: web
    name: labor-management-system
    env: go
    plan: free
    buildCommand: |
      echo "ğŸ”§ Build starting..."
      pwd
      ls -la
      go version
      go mod download
      go mod verify
      echo "ğŸ“¦ Creating bin directory..."
      mkdir -p bin
      echo "ğŸ—ï¸ Building application with CGO..."
      if CGO_ENABLED=1 GOOS=linux go build -v -o bin/main ./cmd/server/main.go; then
        echo "âœ… CGO build successful"
      else
        echo "âš ï¸ CGO build failed, trying without CGO..."
        if CGO_ENABLED=0 GOOS=linux go build -v -o bin/main ./cmd/server/main.go; then
          echo "âœ… Non-CGO build successful"
        else
          echo "âŒ Trying alternative path..."
          if CGO_ENABLED=1 GOOS=linux go build -v -o bin/main cmd/server/main.go; then
            echo "âœ… Alternative CGO build successful"
          else
            echo "âŒ All build attempts failed"
            echo "ğŸ“ Debug info:"
            ls -la cmd/server/
            go env
            exit 1
          fi
        fi
      fi
      echo "âœ… Checking build result..."
      ls -la bin/
      if [ -f bin/main ]; then
        echo "âœ… Binary created successfully"
        file bin/main
        chmod +x bin/main
      else
        echo "âŒ Binary file not found after build"
        exit 1
      fi
      chmod +x start-render.sh
      echo "ğŸ¯ Build process completed"
    startCommand: ./start-render.sh
    envVars:
      - key: PORT
        value: 10000
      - key: GIN_MODE
        value: release
      - key: DATABASE_URL
        fromDatabase:
          name: labor-management-db
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
    autoDeploy: false
    
databases:
  - name: labor-management-db
    plan: free
    databaseName: labor_management
    user: labor_user 